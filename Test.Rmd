---
title: "Test"
author: "Melanie McCord"
date: "10/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stringr)
library(tidytext)
library(caret)
library(rpart)
```
Functions I will be testing: feature selection algorithm
```{r}
data(iris)
# Removes the Species column and gets the correlated features from a dataframe or tibble.
# Parameters: df dataframe with Species as label column.
# Returns: correlation_matrix: matrix of correlations by column.
GetCorrelation <- function(df) {
  df_minus_label <- df %>%
    select(-Species)
  correlation_matrix <- cor(df_minus_label)
  return (correlation_matrix)
}
FeatureSelectionByCorrelation(iris)
```
```{r}
# Removes the label column and gets the correlated features from a dataframe or tibble.
# Parameters: df dataframe; label_col: a string: the name of the label column you need to exclude.
# Returns: correlation_matrix: matrix of correlations by column.
GetCorrelation <- function(df, label_col) {
  df_minus_label <- df %>%
    select(-label_col)
  correlation_matrix <- cor(df_minus_label)
  return (correlation_matrix)
}
GetCorrelation(iris, "Species")
```
```{r}
# Uses GetCorrelatedFeatures to get the highly correlated features (in this case by a factor of 0.7)
# Parameters: df dataframe; label_col: a string: the name of the label column you need to exclude.
# Returns: correlation_matrix: matrix of correlations by column.
SelectOverlyCorrelatedFeatures <- function(df, label_col) {
  correlation_matrix <- GetCorrelation(df, label_col = label_col)
  return (findCorrelation(correlation_matrix, cutoff = 0.7))
}
SelectOverlyCorrelatedFeatures(iris, "Species")
```
Now let's try making the cutoff a parameter.
```{r}
SelectOverlyCorrelatedFeatures <- function(df, label_col, cutoff = 0.7) {
  correlation_matrix <- GetCorrelation(df, label_col = label_col)
  return (findCorrelation(correlation_matrix, cutoff = cutoff))
}
SelectOverlyCorrelatedFeatures(iris, "Species", 0.9)
```
Now let's try removing the highly correlated features and adding back the label column.
```{r}
RemoveHighlyCorrelatedFeatures <- function(df, label_col, cutoff = 0.7) {
  temp <- df %>%
    select(-label_col)
  
  heavily_correlated_features <- SelectOverlyCorrelatedFeatures(df, label_col, cutoff)
  temp = temp[-heavily_correlated_features]
  temp <- add_column(temp, select(df, label_col))
  return (temp)
}
RemoveHighlyCorrelatedFeatures(iris, "Species", 0.7)
```
Now verifying that it does what it says it does.
```{r}
test <- RemoveHighlyCorrelatedFeatures(iris, "Species", 0.7)
GetCorrelation(test, "Species")
```

